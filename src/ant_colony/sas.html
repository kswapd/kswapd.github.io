<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>蚁群算法js版</title>
<style>
.ant{
position:absolute;
background-color:#000000;
overflow:hidden;
width:2px;
height:2px;
}
.food{
background-color:#0000ff;
overflow:hidden;
width:200px;
height:200px;
}

</style>
<script type="text/JavaScript">

//============================
var r=new Array();
var v=new Array();
var dr=new Array();
var dv=new Array();
var x=new Array();
var y=new Array();
var life=new Array();
//单击暂停
var xi0,yi0,xf,yf;
var Time0,str0;
window.status='pause';
//============================
//系统参数初始化
//----------------------------
//生命体数量与轨迹长度
Unit=100;Path=1;
//生命体速度上下限
v0=2;vM=10;
//生命体加速度变化范围
Kr=0.1;Kv=0.1*(vM-v0);
//生命体运动范围
x0=0;xM=document.documentElement.clientWidth;
y0=0;yM=document.documentElement.clientHeight;
//生命体出生地(巢穴)
xi0=x0+(xM-x0)*Math.random();
yi0=y0+(yM-y0)*Math.random();
//str0='<div class="ant" style="left:'+xi0+';top:'+yi0+';"></div>';
str0='div';
//食物所在地
xf=x0+(xM-x0)*Math.random();
yf=y0+(yM-y0)*Math.random();
//气味感知范围
R_2=5*5;
var $ = function(id) {return document.getElementById(id)};
var dc = function(tag) {return document.createElement(tag)};
var food, nest;
//document.onclick = function(){
InitAll = function(){
 if(window.status=='pause'){
  window.status=0;
  nest = dc("div");
  nest.style.position = "absolute";
  nest.style.top = yi0 + "px";
  nest.style.left = xi0 + "px";
  nest.style.width = "20px";
  nest.style.height = "20px";
  nest.style.backgroundColor = "#ff0000";
  document.body.appendChild(nest);
  
  food = dc("div");
  food.style.position = "absolute";
  food.style.top = yf + "px";
  food.style.left = xf + "px";
  food.style.width = "20px";
  food.style.height = "20px";
  food.style.backgroundColor = "#0000ff";
  document.body.appendChild(food);
  
  //测试初始化时间用

  Time0=(new Date()).getTime();
  init(0);
 }else{
  window.status='pause';
 }
}
//窗口大小调整后刷新页面以调整系统参数
 window.onresize = function(){
// window.location.href=document.location;
}
//初始化函数
function init(i){
 if(window.status!='pause'&&i<Unit){
  if(!life[i]){
	life[i]=dc("div");
	life[i].style.position = "absolute";
	life[i].style.top = yi0+"px";
	life[i].style.left = xi0+"px";
	life[i].style.width = "2px";
	life[i].style.height = "2px";
	life[i].style.backgroundColor = "#00003f";
   document.body.appendChild(life[i]);
   x[i]=xi0;
   y[i]=yi0;
   r[i]=Math.random();
   v[i]=1/Math.random();
   dr[i]=Kr*Math.random();
   dv[i]=Kv*Math.random();
  }
  //alert(i+':'+x[i]+":"+y[i]);
  Move(i);
  window.status=i+1;
  //setTimeout('init('+(i+1)+')',i);
  //alert(i);
  setTimeout(function(){init(i+1);},100);
// }else{
//  alert('生成耗时：'+((new Date()).getTime()-Time0)+'ms');
 }
}
//运动函数
Total=Unit*Path;
P2=2*Math.PI;
function Move(i){
 if(window.status!='pause'){
  k=i%Unit;
  X=x[k];
  Y=y[k];
  R=r[k];
  V=v[k];  
  /*
  if(!life[i]){
   //str='<div class="ant" style="left:'+X+';top:'+Y+';"></div>';
   str='div';
   life[i]=document.createElement(str);
   life[i].style.top = Y + "px";
	life[i].style.left = X + "px";
   document.body.appendChild(life[i]);
   alert("no");
  }
  */ 
  if(!life[i]){
	life[i]=dc("div");
	life[i].style.position = "absolute";
	life[i].style.top = Y+"px";
	life[i].style.left = X+"px";
	life[i].style.width = "2px";
	life[i].style.height = "2px";
	life[i].style.backgroundColor = "#00003f";
   document.body.appendChild(life[i]);
   /*x[i]=xi0;
   y[i]=yi0;
   r[i]=Math.random();
   v[i]=1/Math.random();
   dr[i]=Kr*Math.random();
   dv[i]=Kv*Math.random();*/ 
  }
  obj=life[i];
  R+=dr[k]*(2*Math.random()-1);
  V+=dv[k]*(2*Math.random()-1);
  X+=Math.sin(P2*R)*V;
  Y+=Math.cos(P2*R)*V;
  //遇到食物原路返回并减小角度变化
  distance=(X-xf)*(X-xf)+(Y-yf)*(Y-yf);
  if(distance<R_2){
   R+=0.5;
   r[i]/=2;
   v[i]*=2;
  }
  distance=(X-xi0)*(X-xi0)+(Y-yi0)*(Y-yi0);
  if(distance<R_2){
   R+=0.5;
   r[i]/=2;
   v[i]*=2;
  }
  /*----------------------------------
  /*================================*/
  //碰撞边界反弹
  R=(X<x0||X>xM)?-R:R;
  R=(Y<y0||Y>yM)?0.5-R:R;
  X=x[k]+Math.sin(P2*R)*V;
  Y=y[k]+Math.cos(P2*R)*V;
  /*================================*/
  //溢出边界重生(类似流星效果)
  if(X<x0||X>xM||Y<y0||Y>yM){
   X=xi0;
   Y=yi0;
  }
  /*----------------------------------
  /*================================*/
  //边界限制
  X=(X<x0)?x0:(X>xM)?xM-2:X;
  x[k]= X;
  Y=(Y<y0)?y0:(Y>yM)?yM-2:Y;
  y[k]=Y;
  r[k] = R>1?R-1:R<0?R+1:R;
  //r[k]=R;
  V=(V<v0)?v0:((V<vM)?V:vM);
  v[k]=V;
  /*================================*/
   obj.style.left=x[k]+"px";
  obj.style.top=y[k]+"px";
  //alert(x[k]+":"+y[k]);
  //alert(obj.style.left+":"+obj.style.top);
  //setTimeout('Move('+(i+Unit)%Total+')',Unit);
  setTimeout(function(){Move((i+Unit)%Total);},20);
 }
}

//根据浏览器自动加载动画
/*
switch(navigator.appName.toLowerCase()){
 case "netscape":
  window.addEventListener("load",document.onclick,false);
  //alert("netscape");
 break;
 case "microsoft internet explorer":
 default:
  window.attachEvent("onload",document.onclick);
 break;
}
*/
</script>
</head>
<body scroll="no">
<script>
InitAll();
</script>
</body>
</html>